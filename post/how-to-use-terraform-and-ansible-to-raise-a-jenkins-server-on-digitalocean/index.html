<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="/images/favicon.svg">
    
    <link rel="stylesheet" href="/scss/global.min.7c834613444ba8289e55db2f7f35892dcda2bf80c7fd9532773de87cf80ecbbe.css">
    
    <link rel="stylesheet" media="print" href="/scss/print.min.193f43bff9320cd288969561890c18538b569964654e395f5049c5975c65021f.css">

    
    <link rel="stylesheet" href="/css/prism.css" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather&display=swap" rel="stylesheet">
    

 






	




<title>How to use Terraform and Ansible to raise a Jenkins Server on DigitalOcean | Adrian Gheorghe</title>
<meta name="description" content="Published to Medium
 HashiCorp Terraform enables you to safely and predictably create, change, and improve infrastructure. It is an open source tool that codifies APIs into declarative configuration files that can be shared amongst team members, treated as code, edited, reviewed, and versioned.
  In computing, Ansible is an open-source software provisioning, configuration management, and application-deployment tool. It runs on many Unix-like systems, and can configure both Unix-like systems as well as Microsoft Windows.">
<meta property="og:title" content="How to use Terraform and Ansible to raise a Jenkins Server on DigitalOcean | Adrian Gheorghe">
<meta property="og:site_name" content="Adrian Gheorghe">
<meta property="og:description" content="Published to Medium
 HashiCorp Terraform enables you to safely and predictably create, change, and improve infrastructure. It is an open source tool that codifies APIs into declarative configuration files that can be shared amongst team members, treated as code, edited, reviewed, and versioned.
  In computing, Ansible is an open-source software provisioning, configuration management, and application-deployment tool. It runs on many Unix-like systems, and can configure both Unix-like systems as well as Microsoft Windows.">
<meta property="og:url" content="https://www.adigheorghe.ro/post/how-to-use-terraform-and-ansible-to-raise-a-jenkins-server-on-digitalocean/">
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:image" content='https://www.adigheorghe.ro/img/black-textile-41949.jpg'><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="How to use Terraform and Ansible to raise a Jenkins Server on DigitalOcean | Adrian Gheorghe">

	<link rel="canonical" href="https://www.adigheorghe.ro/post/how-to-use-terraform-and-ansible-to-raise-a-jenkins-server-on-digitalocean/">


	<meta name="twitter:site" content="@https://twitter.com/adi_ghe">
	<meta name="twitter:creator" content="@https://twitter.com/adi_ghe">

	<meta name="twitter:description" content="Published to Medium
 HashiCorp Terraform enables you to safely and predictably create, change, and improve infrastructure. It is an open source tool that codifies APIs into declarative configuration files that can be shared amongst team members, treated as code, edited, reviewed, and versioned.
  In computing, Ansible is an open-source software provisioning, configuration management, and application-deployment tool. It runs on many Unix-like systems, and can configure both Unix-like systems as well as Microsoft Windows.">
<meta name="twitter:image" content="https://www.adigheorghe.ro/img/black-textile-41949.jpg">
<meta property="article:published_time" content="2019-05-20T00:00:00&#43;00:00">
	<meta property="article:updated_time" content="2019-05-20T00:00:00&#43;00:00">



    </head>


<body class="line-numbers">

    
    <script src="/js/initColors.js"></script>

    <div class="layout-styled">

        <Section class="section">
    <div class="nav-container">
        <a class="logo-link" href="/">
            <div id="logo-desktop">
    <i class="fas fa-at"></i>
    <svg width="192" viewBox="0 0 304 48" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
        <g transform="matrix(1,0,0,1,-273.769,-89.0174)">
            <g>
                <text class="change-fill" x="272.622px" y="126.713px" style="font-family:'Righteous-Regular', 'Righteous';font-size:50px;">adi</text>
                <text x="359.145px" y="126.713px" style="font-family:'Righteous-Regular', 'Righteous';font-size:50px;fill:rgb(89,89,89);">ghe<tspan x="443.691px 472.646px 492.861px 523.256px " y="126.713px 126.713px 126.713px 126.713px ">orgh</tspan>e</text>
            </g>
        </g>
        <defs>
            <clipPath id="clip0">
                <rect width="191.156" height="23" fill="white" />
            </clipPath>
        </defs>
    </svg>
</div>
<div id="logo-mobile" class="hidden">
    <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
         width="23" height="23" viewBox="0 0 512.000000 512.000000"
         preserveAspectRatio="xMidYMid meet">
        <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
           fill="" stroke="none">
            <path d="M590 4383 l1 -738 756 -530 c698 -489 1151 -807 2618 -1837 l540
   -380 3 748 c2 590 -1 751 -10 760 -7 7 -308 218 -668 470 -360 251 -1230 859
   -1933 1351 -702 491 -1284 893 -1292 893 -13 0 -15 -92 -15 -737z"/>
            <path d="M3887 4708 l-597 -412 0 -381 0 -381 597 -419 c328 -231 602 -421
   610 -423 11 -3 13 204 13 1212 0 987 -2 1216 -13 1216 -7 0 -282 -186 -610
   -412z"/>
            <path d="M590 2135 c0 -910 3 -1225 11 -1225 10 0 343 231 1049 728 l155 109
   0 389 0 388 -595 418 c-327 229 -601 417 -607 418 -10 0 -13 -251 -13 -1225z"/>
            <path d="M590 320 l0 -310 1960 0 1960 0 0 310 0 310 -1960 0 -1960 0 0 -310z"/>
        </g>
    </svg>
</div>
            <span class="header-hidden">Navigate back to the homepage</span>
        </a>
        <div class="nav-controls">
            <a class="resume" href="/resume">
                <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     width="25px" height="30px" viewBox="0 0 45.057 45.057" style="enable-background:new 0 0 25 25;"
                     xml:space="preserve">
                    <g>
                        <g id="_x35_8_24_">
                            <g>
                                <path style="fill:#73737D;" d="M19.558,25.389c-0.067,0.176-0.155,0.328-0.264,0.455c-0.108,0.129-0.24,0.229-0.396,0.301
                                    c-0.156,0.072-0.347,0.107-0.57,0.107c-0.313,0-0.572-0.068-0.78-0.203c-0.208-0.137-0.374-0.316-0.498-0.541
                                    c-0.124-0.223-0.214-0.477-0.27-0.756c-0.057-0.279-0.084-0.564-0.084-0.852c0-0.289,0.027-0.572,0.084-0.853
                                    c0.056-0.281,0.146-0.533,0.27-0.756c0.124-0.225,0.29-0.404,0.498-0.541c0.208-0.137,0.468-0.203,0.78-0.203
                                    c0.271,0,0.494,0.051,0.666,0.154c0.172,0.105,0.31,0.225,0.414,0.361c0.104,0.137,0.176,0.273,0.216,0.414
                                    c0.04,0.139,0.068,0.25,0.084,0.33h2.568c-0.112-1.08-0.49-1.914-1.135-2.502c-0.644-0.588-1.558-0.887-2.741-0.895
                                    c-0.664,0-1.263,0.107-1.794,0.324c-0.532,0.215-0.988,0.52-1.368,0.912c-0.38,0.392-0.672,0.863-0.876,1.416
                                    c-0.204,0.551-0.307,1.165-0.307,1.836c0,0.631,0.097,1.223,0.288,1.77c0.192,0.549,0.475,1.021,0.847,1.422
                                    s0.825,0.717,1.361,0.949c0.536,0.23,1.152,0.348,1.849,0.348c0.624,0,1.18-0.105,1.668-0.312
                                    c0.487-0.209,0.897-0.482,1.229-0.822s0.584-0.723,0.756-1.146c0.172-0.422,0.259-0.852,0.259-1.283h-2.593
                                    C19.68,25.023,19.627,25.214,19.558,25.389z"/>
                                <polygon style="fill:#73737D;" points="26.62,24.812 26.596,24.812 25.192,19.616 22.528,19.616 25.084,28.184 28.036,28.184 30.713,19.616 28,19.616
                                                "/>
                                <path style="fill:#73737D;" d="M33.431,0H5.179v45.057h34.699V6.251L33.431,0z M36.878,42.056H8.179V3h23.706v4.76h4.992L36.878,42.056L36.878,42.056z"
                                />
                            </g>
                        </g>
                    </g>
                </svg>
            </a>
            <button id="copyButton" class="icon-wrapper">
                <svg
    class="icon-image"
    width="24"
    height="20"
    viewBox="0 0 24 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    >
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M2 5C2 3.34328 3.34328 2 5 2H14C15.6567 2 17 3.34328 17 5V9C17 10.6567 15.6567 12 14 12H10C9.44771 12 9 12.4477 9 13C9 13.5523 9.44771 14 10 14H14C16.7613 14 19 11.7613 19 9V5C19 2.23872 16.7613 0 14 0H5C2.23872 0 0 2.23872 0 5V9C0 10.4938 0.656313 11.8361 1.6935 12.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625C3.47028 12.2483 3.43068 11.6164 3.0165 11.2511C2.39169 10.6999 2 9.89621 2 9V5ZM7 11C7 9.34328 8.34328 8 10 8H14C14.5523 8 15 7.55228 15 7C15 6.44772 14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11V15C5 17.7613 7.23872 20 10 20H19C21.7613 20 24 17.7613 24 15V11C24 9.50621 23.3437 8.16393 22.3065 7.24906C21.8923 6.88372 21.2604 6.92332 20.8951 7.3375C20.5297 7.75168 20.5693 8.38361 20.9835 8.74894C21.6083 9.30007 22 10.1038 22 11V15C22 16.6567 20.6567 18 19 18H10C8.34328 18 7 16.6567 7 15V11Z"
      fill="#000"
    />
</svg>
                <div id="toolTip" class="tool-tip " >
                    copied
                </div>
                <input id="copyText" style="opacity: 0;" type="text" class="tool-tip " />
            </button>

            <button id="themeColorButton" class="icon-wrapper">
                <div id="sunRays" class="sun-rays"></div>
                <div id="moonOrSun" class="moon-or-sun"></div>
                <div id="moonMask" class="moon-mask"></div>
            </button>
        </div>
    </div>
</Section>


<script src="/js/toggleLogos.js"></script>


<script src="/js/toggleColors.js"></script>


<script src="/js/copyUrl.js"></script>

        

<section class="section narrow">

    <section id="articleHero" class="section narrow">
    <div class="article-hero">
        <header class="article-header">
            <h1 class="article-hero-heading">How to use Terraform and Ansible to raise a Jenkins Server on DigitalOcean</h1>
            <div class="article-hero-subtitle">
                <div class="article-meta">
                    


    
            <a href="/authors/adrian-gheorghe/" class="article-author-link">
                
                    <div class="article-author-avatar">
                        <img src="/profile-img.jpg" />
                    </div>
                
                
                <strong>Adrian Gheorghe</strong>
                
                <span class="hide-on-mobile">,&nbsp;</span>
            </a>
    



<script src="/js/collapseAuthors.js"></script>
                    May 20, 2019
                     • 10 min read
                </div>
            </div>
        </header>
        
        <div class="article-hero-image" id="ArticleImage__Hero">
            <img src="/img/black-textile-41949.jpg">
        </div>
        
    </div>
</section>

    <aside id="progressBar" class="aside-container">
    <div class="aside-align">
      <div>
        <div class="overlap-container">
        </div>
      </div>
    </div>
    
    <div class="progress-container" tabIndex={-1}>
        <div class="track-line" aria-hidden="true">
            <div id="progressIndicator" class="progress-line"></div>
        </div>
    </div>
</aside>

    <article  id="articleContent" class="post-content">
        <p><a href="https://medium.com/@adrian.gheorghe.dev/how-to-use-terraform-and-ansible-to-raise-a-jenkins-server-on-digitalocean-15246b687666">Published to Medium</a></p>
<blockquote>
<p><a href="https://www.terraform.io/">HashiCorp Terraform</a> enables you to safely and predictably create, change, and improve infrastructure. It is an open source tool that codifies APIs into declarative configuration files that can be shared amongst team members, treated as code, edited, reviewed, and versioned.</p>
</blockquote>
<blockquote>
<p>In computing, <a href="https://www.ansible.com/">Ansible</a> is an open-source software provisioning, configuration management, and application-deployment tool. It runs on many Unix-like systems, and can configure both Unix-like systems as well as Microsoft Windows. It includes its own declarative language to describe system configuration.</p>
</blockquote>
<p>I’m not going to get into the advantages of having both your project infrastructure and configuration in code here, but <a href="https://www.terraform.io/">Terraform</a> and <a href="https://www.ansible.com/">Ansible</a> are great tools for doing both of these.</p>
<h3 id="installing-ansible-and-terraform">Installing Ansible and Terraform</h3>
<p>Start by installing Ansible and Terraform. On MacOSX you can do that using Homebrew, or simply by downloading the binaries from the official websites.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">brew install terraform  
brew install ansible
</code></pre></div><p>After you have Terraform and Ansible accessible, install <a href="https://github.com/adammck/terraform-inventory">terraform-inventory</a>. This is a Go application that generates a dynamic inventory file from your Terraform state. This way, you will be able to use the Terraform newly created server information as your Ansible host.</p>
<p>You might want to install this manually because homebrew does not always have the latest version available.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">brew install terraform-inventory 
</code></pre></div><h3 id="digitalocean-api-keys-and-sshkey">DigitalOcean Api keys and SSH key</h3>
<p>The next step would be to create a DigitalOcean Read Write Token for Terraform to use when connecting to the DigitalOcean api. You can do this in your Account &gt; Api &gt; Personal access tokens. Keep the token safe and well away any versioned code.</p>
<p>In addition to this, in order to store the Terraform state in a secure manner we will be using DigitalOcean Spaces. You will need to create a Space and a Spaces Access Key that Terraform will be using to store its State.</p>
<blockquote>
<p>More information on this can be found in this excellent post by Joseph D. Marhee: <a href="https://medium.com/@jmarhee/digitalocean-spaces-as-a-terraform-backend-b761ae426086">https://medium.com/@jmarhee/digitalocean-spaces-as-a-terraform-backend-b761ae426086</a></p>
</blockquote>
<p>In addition to the access key and token you will need a ssh key that will be used to connect to the droplets.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh-keygen -t rsa -b <span style="color:#ae81ff">4096</span>
</code></pre></div><p>Upload the public key to DigitalOcean and retrieve the key fingerprint, it will be required when you run terraform plan or apply.</p>
<h3 id="terraform-files">Terraform Files</h3>
<p>Create a provider.tf file containing the DigitalOcean backend configuration and set it up with the DataCenter your droplets and spaces will be in.</p>
<pre><code class="language-hcl-terraform" data-lang="hcl-terraform">variable &quot;digitalocean_token&quot; {}  
variable &quot;digitalocean_ssh_fingerprint&quot; {}  
  
provider &quot;digitalocean&quot; {  
    token = &quot;${var.digitalocean_token}&quot;  
    version = &quot;~&gt; 1.0&quot;  
}  
  
terraform {  
  backend &quot;s3&quot; {  
    endpoint = &quot;ams3.digitaloceanspaces.com&quot;  
    region = &quot;us-west-1&quot;  
    key = &quot;terraform.tfstate&quot;  
    skip_requesting_account_id = true  
    skip_credentials_validation = true  
    skip_get_ec2_platforms = true  
    skip_metadata_api_check = true  
  }  
}
</code></pre><p>Now create a jenkins.tf file containing the following configuration.</p>
<pre><code class="language-hcl-terraform" data-lang="hcl-terraform">resource &quot;digitalocean_tag&quot; &quot;jenkins&quot; {  
    name = &quot;example:jenkins&quot;  
}  
  
# Create a new Droplet using the SSH key  
resource &quot;digitalocean_droplet&quot; &quot;example_jenkins&quot; {  
  name     = &quot;example-jenkins&quot;  
  image    = &quot;ubuntu-18-04-x64&quot;  
  region   = &quot;ams3&quot;  
  size     = &quot;s-1vcpu-1gb&quot;  
  ipv6 = true  
  private_networking = true  
  ssh_keys = [&quot;${var.digitalocean_ssh_fingerprint}&quot;]  
  tags = [&quot;${digitalocean_tag.jenkins.name}&quot;]  
}
</code></pre><p>This will create a 1CPU 1GB RAM Ubuntu 18.04 64b Droplet with the name example-jenkins. The Droplet will be created in the Amsterdam DigitalOcean DataCenter, but you can change this to whatever one you need. The ssh key attached to the droplet will be the one you pass in when asking Terraform to create the droplets.</p>
<p>Assuming you want to point a domain or subdomain to the new droplet, you can use Terraform for that as well. The following configuration will add example.org as a domain in your DigitalOcean DNS management and then add a jenkins.example.org A record pointing to that IP.</p>
<pre><code class="language-hcl-terraform" data-lang="hcl-terraform">resource &quot;digitalocean_domain&quot; &quot;exampleorg&quot; {  
    name = &quot;example.org&quot;  
}  
  
resource &quot;digitalocean_record&quot; &quot;exampleorg&quot; {  
    name = &quot;jenkins&quot;  
    type = &quot;A&quot;  
    domain = &quot;${digitalocean_domain.exampleorg.name}&quot;  
    value = &quot;${digitalocean_droplet.example_jenkins.ipv4_address}&quot;  
}
</code></pre><p>The last bit of infrastructure configuration we will want to add is to set the droplet firewall to only allow specific ports open. (22 for SSH, 80 and 443 for web access and 8080 which is the default port Jenkins runs on)</p>
<pre><code class="language-hcl-terraform" data-lang="hcl-terraform">resource &quot;digitalocean_firewall&quot; &quot;jenkins&quot; {  
    name = &quot;firewall-jenkins&quot;  
    droplet_ids = [&quot;${digitalocean_droplet.example_jenkins.id}&quot;]  
  
    inbound_rule = [  
        {  
            protocol = &quot;tcp&quot;  
            port_range = &quot;22&quot;  
        },  
        {  
            protocol = &quot;tcp&quot;  
            port_range = &quot;80&quot;  
        },  
        {  
            protocol = &quot;tcp&quot;  
            port_range = &quot;443&quot;  
        },  
        {  
            protocol = &quot;tcp&quot;  
            port_range = &quot;8080&quot;  
        }  
    ]  
}
</code></pre><h3 id="init-terraform-plan-andapply">Init Terraform, Plan and Apply</h3>
<p>Initialize terraform with the correct access key</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">terraform init <span style="color:#ae81ff">\ </span> 
   -backend-config<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;access_key=AAABBBCCCDDDEEE&#34;</span> <span style="color:#ae81ff">\ </span> 
   -backend-config<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secret_key=AAABBBCCCDDDEEE&#34;</span> <span style="color:#ae81ff">\ </span> 
   -backend-config<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bucket=AAABBBCCCDDDEEE&#34;</span>

<span style="color:#75715e"># Run terraform plan to check what the script will actually do.</span>  
terraform plan

<span style="color:#75715e"># Run terraform apply to create the droplet</span>  
terraform apply
</code></pre></div><p>After this hopefully you should have an Ubuntu droplet set up to accept SSH connections and the domain jenkins.example.org pointing to it. Let’s move on to provisioning it.</p>
<h3 id="provisioning-the-droplet-withansible">Provisioning the droplet with Ansible</h3>
<p>In order to provision the droplet we will need to run an Ansible playbook.</p>
<p>Create a an Ansible requirements.yml file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">--<span style="color:#e6db74">-  </span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">- src: geerlingguy.git  </span>
- src: geerlingguy.java  
- src: geerlingguy.jenkins  
- src: hispanico.nginx-revproxy  
- src: hispanico.letsencrypt-nginx-revproxy  
- src: geerlingguy.mysql  
- src: geerlingguy.docker  
- src: geerlingguy.ansible  
- src: geerlingguy.pip
</code></pre></div><p>Create a jenkins.yml playbook either in this directory.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">--<span style="color:#e6db74">-  </span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">- hosts: example_jenkins  </span>
  become: <span style="color:#66d9ef">true</span>  
  any_errors_fatal: <span style="color:#66d9ef">true</span>  
  gather_facts: no  
  pre_tasks:  
    - name: <span style="color:#e6db74">&#39;install python2&#39;</span>  
      raw: sudo apt-get -y install python  
    - name: Set the java_packages variable (Ubuntu).  
      set_fact:  
        java_packages:  
          - openjdk<span style="color:#ae81ff">-8</span>-jdk  
    - name: update cache  
      apt:  
        update_cache: <span style="color:#66d9ef">true</span>  
    - name: Install apache2-utils  
      apt:  
        name: apache2-utils  
        state: present  
  
- hosts: example_jenkins  
  become: <span style="color:#66d9ef">true</span>  
  any_errors_fatal: <span style="color:#66d9ef">true</span>  
  gather_facts: yes  
  vars:  
    jenkins_hostname: jenkins.example.org  
  roles:  
    - role: geerlingguy.java  
    - role: geerlingguy.jenkins  
      become: yes  
      vars:  
        jenkins_admin_username: admin  
        jenkins_admin_password: admin  
        jenkins_package_state: present  
    - role: hispanico.nginx-revproxy  
    - role: hispanico.letsencrypt-nginx-revproxy  
      vars:  
        nginx_revproxy_sites:  
          jenkins.example.org:  
            domains:  
              - jenkins.example.org  
            upstreams:  
              - { backend_address: <span style="color:#ae81ff">127.0</span><span style="color:#ae81ff">.0</span><span style="color:#ae81ff">.1</span>, backend_port: <span style="color:#ae81ff">8080</span> }  
            letsencrypt: <span style="color:#66d9ef">true</span>  
            letsencrypt_email: <span style="color:#e6db74">&#39;test@example.org&#39;</span>  
            ssl: <span style="color:#66d9ef">true</span>  
    - role: geerlingguy.pip  
      vars:  
        ansible_install_method: pip  
        ansible_install_version_pip: <span style="color:#e6db74">&#34;2.7.0&#34;</span>  
    - role: geerlingguy.ansible  
    - role: geerlingguy.docker
</code></pre></div><h3 id="https">HTTPS</h3>
<p>The Jenkins service exposes the UI on port 8080 by default. In order to access Jenkins via HTTPS the Ansible playbook contains an nginx proxy running on the same server. These excellent roles add an nginx proxy service on the same droplet and generate a SSL Certificate using Let’s Encrypt.</p>
<p><a href="https://github.com/hispanico/ansible-nginx-revproxy"><strong>hispanico/ansible-nginx-revproxy</strong></a></p>
<h3 id="run-the-ansible-provisioning-script">Run the Ansible provisioning script:</h3>
<p>After terraform has finished deploying the droplet, run the following commands.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ansible-galaxy install -r requirements.yml

ansible-playbook --inventory<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>which terraform-inventory<span style="color:#e6db74">`</span> --private-key<span style="color:#f92672">=</span>id_rsa --user<span style="color:#f92672">=</span>root jenkins.yml
</code></pre></div><p>In order to provision the droplet, you should be able to add a provisioner declaration in your jenkins.tf file like the one below. I personally have not been able to get this to work using terraform-inventory so I’ve kept the scripts completely separate.</p>
<pre><code class="language-hcl-terraform" data-lang="hcl-terraform">
provisioner &quot;local-exec&quot; {  
    command = &lt;&lt;EOT  
      ls -al  
      ansible-galaxy install -r requirements.yml  
      ansible-playbook --inventory=`which terraform-inventory` --private-key=id_rsa --user=root jenkins.yml  
    EOT  
}
</code></pre><p>When the Ansible script finishes, you should have Jenkins installed in the new Droplet.</p>
<p>Accessing <a href="http://jenkins.example.org">http://jenkins.example.org</a>:8080 should give you access to the Jenkins UI.
Accessing <a href="http://jenkins.example.org">https://jenkins.example.org</a> should give you the Jenkins UI via https.</p>

    </article>

    
    





    
    
    
        
    




<section id="articleNext" class="section nartrow">
    <h3 class="footer-next-heading">More articles from Adrian Gheorghe</h3>
    <div class="footer-spacer"></div>
    <div class="next-articles-grid" numberOfArticles={numberOfArticles}>
        <div class="post-row">
            
                <a href="/post/how-to-host-your-static-website-on-github-pages/" class="article-link"
                 id="article-link-bigger">
                    <div>
                        <div class="image-container">
                            <img src="/img/1__LFiJenS3MWyUQ6zElDdv9Q.jpeg" class="article-image" /> 
                        </div>
                        <div>
                            <h2 class="article-title">
                                How to host your static website on Github Pages
                            </h2>
                            <p class="article-excerpt">
                                Lately I’ve noticed I’ve been paying quite a bit of money on hosting. Well not really a lot, but I thought I could do with optimising what…
                            </p>
                            <div class="article-metadata">
                                April 4, 2019 · 2 min read
                            </div>
                        </div>
                    </div>
                </a>
            
                <a href="/post/docker-swarm-volume-data-persistence-on-digital-ocean-with-rexray/" class="article-link"
                >
                    <div>
                        <div class="image-container">
                            <img src="/img/gray-rocks-in-front-of-mountain-939719.jpg" class="article-image" /> 
                        </div>
                        <div>
                            <h2 class="article-title">
                                Docker Swarm volume data persistence on Digital Ocean with RexRay
                            </h2>
                            <p class="article-excerpt">
                                This article is PART 2 of a series on Dockerizing your own personal infrastructure (Docker Swarm, RexRay, Traefik, Let’s Encrypt…
                            </p>
                            <div class="article-metadata">
                                March 3, 2019 · 5 min read
                            </div>
                        </div>
                    </div>
                </a>
            
        </div>
    </div>
</section>

</section>


 <script src="/js/progressBar.js"></script>

        
        <div class="footer-gradient"></div>
    <div class="section narrow">
      <div class="footer-hr"></div>
      <div class="footer-container">
        <div class="footer-text">
          © 2020 Adrian Gheorghe
        </div>
        <div class="social-icon-outer">
    <div class="social-icon-container">
        
            
                
                <a href="https://www.facebook.com/adrian.gheorghe.7"><svg
class="social-icon-image"
width="7"
height="14"
viewBox="0 0 7 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M4.36849 7.36482H6.35279L6.64986 4.99457H4.36849V3.48124C4.36849 2.79501 4.55373 2.32731 5.5103 2.32731L6.73028 2.32673V0.206821C6.51919 0.17804 5.79505 0.113525 4.95257 0.113525C3.19363 0.113525 1.98943 1.21807 1.98943 3.24662V4.99464H0V7.36488H1.98936V13.4469L4.36849 13.4468V7.36482Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://www.facebook.com/adrian.gheorghe.7</span>
            
        
            
                
                <a href="https://github.com/adrian-gheorghe"><svg
class="social-icon-image"
width="14"
height="14"
viewBox="0 0 14 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M7 0C3.1325 0 0 3.21173 0 7.17706C0 10.3529 2.00375 13.0353 4.78625 13.9863C5.13625 14.0491 5.2675 13.8338 5.2675 13.6454C5.2675 13.4749 5.25875 12.9097 5.25875 12.3087C3.5 12.6406 3.045 11.8691 2.905 11.4653C2.82625 11.259 2.485 10.622 2.1875 10.4516C1.9425 10.317 1.5925 9.98508 2.17875 9.97611C2.73 9.96714 3.12375 10.4964 3.255 10.7118C3.885 11.7973 4.89125 11.4923 5.29375 11.3039C5.355 10.8374 5.53875 10.5234 5.74 10.3439C4.1825 10.1645 2.555 9.54549 2.555 6.80026C2.555 6.01976 2.82625 5.37382 3.2725 4.87143C3.2025 4.692 2.9575 3.95635 3.3425 2.96951C3.3425 2.96951 3.92875 2.78111 5.2675 3.70516C5.8275 3.54367 6.4225 3.46293 7.0175 3.46293C7.6125 3.46293 8.2075 3.54367 8.7675 3.70516C10.1063 2.77214 10.6925 2.96951 10.6925 2.96951C11.0775 3.95635 10.8325 4.692 10.7625 4.87143C11.2087 5.37382 11.48 6.01079 11.48 6.80026C11.48 9.55446 9.84375 10.1645 8.28625 10.3439C8.54 10.5682 8.75875 10.9988 8.75875 11.6717C8.75875 12.6316 8.75 13.4032 8.75 13.6454C8.75 13.8338 8.88125 14.0581 9.23125 13.9863C11.9963 13.0353 14 10.3439 14 7.17706C14 3.21173 10.8675 0 7 0Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://github.com/adrian-gheorghe</span>
            
        
            
                
                <a href="https://www.linkedin.com/in/adrian-gheorghe-01836344/"><svg
class="social-icon-image"
width="14"
height="14"
viewBox="0 0 14 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
{...props}
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M3.59615 13.125H0.871552V4.36523H3.59615V13.125ZM2.24847 3.16406C1.81878 3.16406 1.44769 3.00781 1.13519 2.69531C0.822692 2.38281 0.666443 2.01171 0.666443 1.58203C0.666443 1.15234 0.822692 0.781248 1.13519 0.468749C1.44769 0.156249 1.81878 0 2.24847 0C2.67816 0 3.04925 0.156249 3.36175 0.468749C3.67425 0.781248 3.8305 1.15234 3.8305 1.58203C3.8305 2.01171 3.67425 2.38281 3.36175 2.69531C3.04925 3.00781 2.67816 3.16406 2.24847 3.16406ZM13.7915 13.125H11.0669V8.84765C11.0669 8.14452 11.0083 7.63671 10.8911 7.32421C10.6763 6.79687 10.2563 6.5332 9.63134 6.5332C9.00634 6.5332 8.56689 6.76757 8.31298 7.23632C8.11767 7.58788 8.02001 8.10546 8.02001 8.78905V13.125H5.32471V4.36523H7.93212V5.5664H7.96142C8.15673 5.17578 8.46923 4.85351 8.89892 4.59961C9.36767 4.28711 9.91454 4.13086 10.5395 4.13086C11.8091 4.13086 12.6977 4.53125 13.2055 5.33203C13.5962 5.97656 13.7915 6.97265 13.7915 8.3203V13.125Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://www.linkedin.com/in/adrian-gheorghe-01836344/</span>
            
        
            
                
                <a href="https://medium.com/@adrian.gheorghe.dev"><svg
class="social-icon-image"
width="13"
height="11"
viewBox="0 0 13 11"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M1.51041 2.69775C1.51041 2.5415 1.44965 2.40261 1.32812 2.28108L0.15625 0.874837V0.666504H3.82812L6.64061 6.86441L9.11456 0.666504H12.6041V0.874837L11.5885 1.83838C11.5017 1.90782 11.467 2.00331 11.4843 2.12483V9.20815C11.467 9.32968 11.5017 9.42516 11.5885 9.49461L12.5781 10.4581V10.6665H7.63019V10.4581L8.64581 9.46857C8.6979 9.41648 8.72828 9.37742 8.73696 9.35138C8.74564 9.32534 8.74998 9.26891 8.74998 9.18211V3.45296L5.93749 10.6404H5.54686L2.23958 3.45296V8.27065C2.22222 8.47898 2.28298 8.66128 2.42187 8.81753L3.74999 10.4321V10.6404H0V10.4321L1.32812 8.81753C1.48437 8.66128 1.54514 8.47898 1.51041 8.27065V2.69775Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://medium.com/@adrian.gheorghe.dev</span>
            
        
            
                
                <a href="https://twitter.com/adi_ghe"><svg
class="social-icon-image"
width="16"
height="13"
viewBox="0 0 16 13"
fill="none"
xmlns="http://www.w3.org/2000/svg"
{...props}
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M14.0658 2.34438C14.7013 1.96349 15.1892 1.3604 15.419 0.641811C14.8244 0.994439 14.1658 1.25056 13.4648 1.3886C12.9034 0.7905 12.1036 0.416748 11.2185 0.416748C9.51888 0.416748 8.14096 1.79461 8.14096 3.49411C8.14096 3.7353 8.16822 3.97019 8.22068 4.19542C5.66301 4.06708 3.39543 2.84191 1.8776 0.980064C1.6127 1.43458 1.46094 1.96322 1.46094 2.52719C1.46094 3.59485 2.00428 4.5368 2.83003 5.08865C2.32553 5.07268 1.85104 4.93425 1.43608 4.70376C1.43586 4.71659 1.43586 4.72949 1.43586 4.74244C1.43586 6.23349 2.49666 7.47732 3.90448 7.75999C3.64622 7.83033 3.37436 7.86792 3.09366 7.86792C2.89537 7.86792 2.70257 7.84866 2.51471 7.81272C2.90629 9.03537 4.0428 9.92509 5.38945 9.94994C4.33623 10.7753 3.00928 11.2673 1.56749 11.2673C1.31911 11.2673 1.07413 11.2528 0.833374 11.2243C2.19527 12.0975 3.81291 12.6069 5.55081 12.6069C11.2113 12.6069 14.3067 7.91763 14.3067 3.85096C14.3067 3.71753 14.3037 3.5848 14.2978 3.45285C14.899 3.01896 15.4208 2.47694 15.8334 1.8598C15.2815 2.10456 14.6884 2.26998 14.0658 2.34438Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://twitter.com/adi_ghe</span>
            
        
    </div>
</div>
    </div>
</div>

    </div>

    
    <script src="/js/prism.js"></script>
</body>

</html>